var captureObjects=[],removeCaptureObject=function(t){null!=t&&captureObjects.includes(t)&&(captureObjects[t]=null)};class CaptureAPI{constructor(t,a,s){this.tabID=t,this.windowHeight=a,this.pageHeight=s,this.maxSnapshots=0,this.snapshots=[],this.snapshotInterval=1e3}init(){this.maxSnapshots=this.calcMaxSnapshots()}calcMaxSnapshots(){var t=Math.floor(this.pageHeight/this.windowHeight),a=this.pageHeight%this.windowHeight;return this.windowHeight>a&&(t+=a/this.windowHeight),t}takeSnapshot(t,a,s){return new Promise((e,n)=>{var i=this.maxSnapshots-this.snapshots.length;this.maxSnapshots,this.snapshots.length;"function"!=typeof t&&n("invalid takeSnapshot parameters given!"),(this.maxSnapshots>20||this.pageHeight>4e3)&&n("too tall page to take snapshot"),i>0?setTimeout(function(){chrome.tabs.captureVisibleTab({format:"jpeg"},function(t,a,s,e){this.snapshots.push(e),chrome.tabs.sendMessage(this.tabID,{message:"scrollTop"},function(t,a,s,e){"Scrolled"===e.message&&(chrome.runtime.sendMessage({message:"update-snapshot-process",data:100*this.snapshots.length/this.maxSnapshots}),this.takeSnapshot.call(this,t,a,s))}.bind(this,t,a,s))}.bind(this,t,a,s))}.bind(this,t,a,s),this.snapshotInterval):e(t.call(a,s,this.snapshots))})}}chrome.runtime.onMessage.addListener(function(t,a,s){if("take-snapshot"===t.message&&null!=t.data&&null!=t.data.tabID&&null!=t.data.windowHeight&&null!=t.data.pageHeight)return captureObjects[t.data.tabID]=new CaptureAPI(t.data.tabID,t.data.windowHeight,t.data.pageHeight),captureObjects[t.data.tabID].init(),captureObjects[t.data.tabID].takeSnapshot(function(a,s){for(var e=[],n=captureObjects[t.data.tabID],i=0;i<s.length;i++){var h=0,o=s.length-1;i<o||i==o&&n.maxSnapshots%1==0?h=i*n.windowHeight:i==o&&n.maxSnapshots%1!=0&&(h=i*n.windowHeight,h-=n.windowHeight-n.maxSnapshots%1*n.windowHeight),e.push({src:s[i],x:0,y:h})}return a({data:e}),!0},null,s).then(function(t){}).catch(function(t){s({data:null,error:t})}),!0}),chrome.tabs.onUpdated.addListener(function(t){removeCaptureObject(t)}),chrome.tabs.onRemoved.addListener(function(t){removeCaptureObject(t)});